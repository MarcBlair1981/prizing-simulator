<!doctype html>
<meta charset="utf-8">
<title id="pageTitle">F2P – Interactive Odds Demo (SPLASH Tech, v3.0)</title>
<link rel="stylesheet" href="style.css">
<!-- Add Inter font -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="brandbar" oncontextmenu="return false">
  <div class="brandwrap">
    <div class="brandlogo"><img id="brandLogo" alt="SPLASH Tech" draggable="false"></div>
    <div>
      <div class="brandname" id="brandName">SPLASH Tech</div>
      <div class="brandsub" id="brandSub">Free-to-Play Projection Tools</div>
    </div>
    <div style="margin-left:auto" class="brandsub" id="version">v3.0</div>
  </div>
</div>
<div class="wm" id="wm"></div>

<div class="wrap">
  <h2 style="margin:0 0 6px 0" id="mainHeader">F2P – Interactive Odds Demo</h2>
  <div class="muted" id="introText">Enter question text and decimal odds for the <b>optimal pick</b>. Use the controls
    to project
    winners and the full score distribution.</div>

  <div class="grid g2" style="margin-top:12px">
    <div class="card">
      <div class="muted" id="participantsLabel">Participants</div>
      <input id="participants" type="number" min="100" step="100" value="1000">
      <div class="muted" style="margin-top:8px" id="questionsCountLabel">Number of questions</div>
      <input id="qcount" type="number" min="1" max="50" step="1" value="6">

      <div class="muted" style="margin-top:8px" id="gameTemplateLabel">Game Template</div>
      <select id="gameTemplate" style="margin-bottom:8px">
        <option value="" id="selectTemplatePlaceholder">(Select a template)</option>
      </select>

      <div class="muted" id="questionTemplateLabel">Question template</div>
      <input id="template" list="templates" type="text" placeholder="Type or choose (auto-fills when you add rows)">
      <datalist id="templates">
        <option>Which team will win the match?</option>
        <option>Will both teams score?</option>
        <option>Who will win the fight?</option>
        <option>How many Touchdowns will be scored?</option>
        <option>Will Erling Haaland score?</option>
        <option>Will Lamine Yamal score or assist?</option>
        <option>How many corners will be taken?</option>
        <option>How many shots on target for [Player]?</option>
        <option>How many tackles will [Player] make?</option>
        <option>In what minute will the first goal be scored?</option>
        <option>Which listed player will receive a yellow card?</option>
        <option>How many passes will [Player] complete?</option>
      </datalist>
    </div>

    <div class="card">
      <div class="muted row hidden" id="oddsMultiplierRow"
        title="Multiplies each DECIMAL odd before converting to probability (p = 1/(odds × multiplier)). Lower = easier; Higher = harder.">
        <span id="oddsMultiplierLabel">Odds multiplier</span><span class="pill" id="multDisp">×1.00</span>
      </div>
      <div class="row hidden" style="margin-top:6px"><input id="mult" type="range" min="0.50" max="2.00" step="0.01"
          value="1.00"></div>

      <div class="muted" style="margin-top:10px" id="quickActionsLabel">Quick actions</div>
      <div class="row" style="margin-top:6px">
        <button id="addRow" class="btn">Add question</button>
        <button id="clearRows" class="btn">Clear all</button>
        <button id="example" class="btn">Load example</button>
        <button id="export" class="btn">Export JSON</button>
        <button id="loadCSV" class="btn">Load CSV</button>
        <input type="file" id="csvFileInput" accept=".csv" style="display:none">
        <label class="row" style="margin-left:auto;gap:6px;align-items:center">
          <input id="toggleImplied" type="checkbox" checked>
          <span class="muted" id="showImpliedLabel">Show Implied Odds</span>
        </label>
      </div>

      <div style="border-top:1px solid rgba(59, 80, 111, 0.3);margin-top:16px;padding-top:4px"></div>

      <div class="muted" style="margin-top:10px" id="bulkOperationsLabel">Operations</div>
      <div class="row" style="margin-top:6px;gap:8px">
        <select id="uniformOddsSelect"
          style="width:240px;background:#0b152a;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px"></select>
        <button id="applyUniform" class="btn" style="margin-left:auto;min-width:120px">Apply Odds</button>
      </div>

      <div class="muted" style="margin-top:12px" id="paytablePresetsLabel">Paytable Presets</div>
      <div class="row" style="margin-top:6px;gap:8px">
        <select id="presetSelect"
          style="width:240px;background:#0b152a;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:8px 10px"></select>
        <button id="applyPreset" class="btn" style="margin-left:auto;min-width:120px">Apply Paytable</button>
      </div>

      <div style="border-top:1px solid rgba(59, 80, 111, 0.3);margin-top:12px;padding-top:8px"></div>

      <div class="row" style="margin-top:6px;gap:8px">
        <label class="row" style="gap:6px;align-items:center">
          <input id="applyStructure" type="checkbox" checked>
          <span class="muted" id="applyStructureLabel">Apply structure (N & odds)</span>
        </label>
        <button id="previewPreset" class="btn" style="margin-left:auto;min-width:120px">Preview</button>
      </div>
      <div id="presetPreview" class="muted"
        style="margin-top:8px;max-height:0;overflow:hidden;transition:max-height 0.3s ease"></div>

      <div id="status" class="muted" style="margin-top:6px"></div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="muted" id="questionsListLabel">Questions (type to edit; odds = decimal for optimal pick)</div>
    <div id="qlist"></div>
  </div>

  <div class="grid g3" style="margin-top:12px">
    <div class="card">
      <div class="muted" id="statQuestions">Questions</div>
      <div id="qstat" class="big">–</div>
    </div>
    <div class="card">
      <div class="muted" id="statProb">Combined optimal-path probability</div>
      <div id="comb" class="big">–</div>
    </div>
    <div class="card">
      <div class="muted"><span id="statWinners">Expected perfect winners @</span> <span id="pdisp"></span></div>
      <div id="winners" class="big">–</div>
    </div>
  </div>

  <div class="grid g2" style="margin-top:12px">
    <div class="card">
      <div class="muted" id="statExpectedCost">Expected Cost</div>
      <div id="expectedCost" class="big">–</div>
    </div>
    <div class="card">
      <div class="muted" id="statCostPerUser">Expected Cost Per User</div>
      <div id="costPerUser" class="big">–</div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="grid g3" style="align-items:center">
      <div>
        <div class="muted" id="observedCostRatioLabel">Observed Cost Ratio</div>
        <input id="observedCostRatio" type="number" min="0" max="2" step="0.01" value="1.00" style="max-width:120px">
        <div class="muted" style="font-size:11px;margin-top:4px;opacity:0.7">Default: 1.0 (common alternative: 0.3)
        </div>
      </div>
      <div class="card" style="background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3)">
        <div class="muted" id="statExpectedCostObserved">Expected Cost (Observed)</div>
        <div id="expectedCostObserved" class="big" style="color:#60a5fa">–</div>
      </div>
      <div class="card" style="background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3)">
        <div class="muted" id="statCostPerUserObserved">Expected Cost Per User (Observed)</div>
        <div id="costPerUserObserved" class="big" style="color:#60a5fa">–</div>
      </div>
    </div>
  </div>

  <div class="card" style="margin-top:12px">
    <div class="muted" id="distTableLabel">Expected users at each score (Poisson–binomial, independent questions)</div>
    <table class="table" id="dist"></table>
  </div>

  <div class="card" style="margin-top:12px;position:relative">
    <div class="muted chart-title" style="margin-bottom:6px" id="chartSectionTitle">
      <b>Score distribution</b> — X: score (0..N), Y: % of users. Line = CDF (≤ score).
    </div>
    <svg id="chart" class="chart" viewBox="0 0 1000 320" preserveAspectRatio="none"></svg>
    <div id="tt" class="tooltip" style="display:none"></div>
  </div>

  <!-- Export Report Section -->
  <div class="card"
    style="margin-top:24px;border:2px solid rgba(96,165,250,0.4);background:linear-gradient(135deg, rgba(11,21,42,0.95) 0%, rgba(20,35,70,0.95) 100%)">
    <div style="display:flex;align-items:center;gap:12px;margin-bottom:16px">
      <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#60a5fa" stroke-width="2">
        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
        <polyline points="14 2 14 8 20 8"></polyline>
        <line x1="16" y1="13" x2="8" y2="13"></line>
        <line x1="16" y1="17" x2="8" y2="17"></line>
        <polyline points="10 9 9 9 8 9"></polyline>
      </svg>
      <div>
        <div style="font-weight:600;font-size:16px;color:#fff">Export Client Report</div>
        <div class="muted" style="font-size:12px">Generate a branded PDF or CSV report for your client</div>
      </div>
    </div>

    <div class="grid g2" style="gap:16px">
      <!-- Left Column: Branding -->
      <div>
        <div class="muted" style="margin-bottom:8px;font-weight:600;color:#60a5fa">Client Branding</div>

        <div class="muted" style="margin-bottom:4px">Client Name</div>
        <input id="clientName" type="text" placeholder="Enter client company name" style="margin-bottom:12px">

        <div class="muted" style="margin-bottom:4px">Client Logo</div>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
          <button id="uploadClientLogo" class="btn" style="flex:1">Upload Logo</button>
          <input type="file" id="clientLogoInput" accept="image/*" style="display:none">
          <div id="clientLogoPreview"
            style="width:40px;height:40px;border:1px dashed #3b506f;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden">
            <span class="muted" style="font-size:10px">No logo</span>
          </div>
        </div>

        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
          <input id="includeSplashLogo" type="checkbox" checked>
          <span class="muted">Include SPLASH Tech logo</span>
        </label>

        <label style="display:flex;align-items:center;gap:8px;cursor:pointer;margin-top:8px">
          <input id="includeObservedCost" type="checkbox" checked>
          <span class="muted">Include Observed Cost parameters</span>
        </label>
        <div class="muted" style="font-size:10px;margin-left:24px;opacity:0.7">Uncheck if observed cost ≈ expected cost
        </div>
      </div>

      <!-- Right Column: Game Info -->
      <div>
        <div class="muted" style="margin-bottom:8px;font-weight:600;color:#60a5fa">Game Information</div>

        <div class="muted" style="margin-bottom:4px">Game Name / Title</div>
        <input id="gameName" type="text" placeholder="e.g., Premier League Pick 9" style="margin-bottom:12px">

        <div class="muted" style="margin-bottom:4px">Game Description</div>
        <textarea id="gameDescription" placeholder="Describe the game format, rules, and any special conditions..."
          style="width:100%;min-height:80px;background:#0b152a;color:var(--text);border:1px solid var(--line);border-radius:10px;padding:10px;resize:vertical;font-family:inherit"></textarea>
      </div>
    </div>

    <div style="border-top:1px solid rgba(59,80,111,0.5);margin:20px 0 16px 0"></div>

    <div style="display:flex;gap:12px;flex-wrap:wrap">
      <button id="exportPDF" class="btn"
        style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);padding:12px 24px;font-weight:600;flex:1;min-width:200px">
        <span style="display:flex;align-items:center;justify-content:center;gap:8px">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <path d="M12 18v-6"></path>
            <path d="M9 15l3 3 3-3"></path>
          </svg>
          Export PDF Report
        </span>
      </button>
      <button id="exportCSV" class="btn"
        style="background:linear-gradient(135deg,#10b981,#059669);padding:12px 24px;font-weight:600;flex:1;min-width:200px">
        <span style="display:flex;align-items:center;justify-content:center;gap:8px">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
            <polyline points="14 2 14 8 20 8"></polyline>
            <line x1="8" y1="13" x2="16" y2="13"></line>
            <line x1="8" y1="17" x2="16" y2="17"></line>
          </svg>
          Export CSV Data
        </span>
      </button>
    </div>
  </div>

</div>

<!-- jsPDF library for PDF generation -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>

<script src="config.js"></script>
<script src="presets.js"></script>
<script src="script.js"></script>